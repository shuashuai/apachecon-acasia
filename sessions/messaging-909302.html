<!DOCTYPE HTML>

<html>
<head>
    <title>Storage Engine for RocketMQ Based on Commitlog and RocksDB - Community Over Code Asia 2025 - Powered by ALC-Beijing</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'unsafe-inline' 'unsafe-eval' *; style-src 'unsafe-inline' *; img-src * data:; font-src * data:; connect-src *; frame-src * maps: ;">

    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <meta property='og:title' content='Storage Engine for RocketMQ Based on Commitlog and RocksDB'/>
    <meta property='og:url' content='https://asia.communityovercode.org'/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <base href="/"/>
    
    <link rel="icon" type="image/png" href="images/favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css"/>

    
    <link rel="stylesheet" href="/scss/main.min.f327fac657d730f3f1b9f16418e56111a1b2dc2bb77a5c8ef7e2e089db2941bc.css">
    
    <link rel="stylesheet" href="/scss/acasia2021.min.f7f58a4c9ff35c6c173a83010ea7e86ef4f57dd469455a6bed73cb3450006a08.css">

    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.dropotron.min.js"></script>
    <noscript>
        
    </noscript>
    <link rel="stylesheet" href="css/search.css"/>
</head>

<body>


<div class="wrapper style1">

    <div id="header" class="sub-banner position-relative d-flex flex-column">
        
<nav id="nav" class="navbar navbar-expand-lg bg-transparent">
  <div class="container py-1">
    <div class="btn-wrap d-flex align-items-center justify-content-between">
        
            <a href="index.html" class="navbar-brand">
                <img class="logo-img" src="images/2025-logo.png" height="120" width="200px" ALIGN=CENTER>
            </a>
        
         <button
            onclick="changeMenuBg()"
            class="navbar-toggler" 
            type="button"
            data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
        <ul class="navbar-nav">
            
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        Home
                    </a>
                </li>
            
            
            
                <li class="nav-item">
                    
                    <a href="/tracks.html" class="nav-link">Schedule</a>
                </li>
            
                <li class="nav-item">
                    
                    <a href="/guide/visa_letter_request.html" class="nav-link">Guide</a>
                </li>
            
                <li class="nav-item">
                    
                    <a href="/sponsor.html" class="nav-link">Sponsor</a>
                </li>
            
                <li class="nav-item">
                    
                    <a href="/venue_travel/venue.html" class="nav-link">Venue &#43; Travel</a>
                </li>
            
            
                
                    <li class="nav-item">
                        <a href="/zh/sessions/messaging-909302.html" class="nav-link" >中文</a>
                    </li>
                
            
            <div class="ms-0 ms-lg-4">
                <a href="index.html#register" role="button" class="btn btn-warning">
                    Register
                </a>
            </div>
            
        </ul>
    </div>
  </div>
</nav>
<script>
    const isHome = "false";
    function changeMenuBg () {
        const nav = document.getElementById('nav');
        if (isHome !== 'true') {
            return;
        }
        if (nav.classList.contains('bg-custom')) {
            nav.classList.remove('bg-custom');
            nav.classList.add('bg-transparent');
        } else {
            nav.classList.add('bg-custom');
            nav.classList.remove('bg-transparent');
        }
    }

</script>

    </div>

    
    <div id="main" class="wrapper style4 page-session">

        
        <div id="content" class="container">
            <section>
                <header class="major">
                    <h3 class="text-center">Storage Engine for RocketMQ Based on Commitlog and RocksDB</h3>
                    <h4>Zhou Li</h4>
                    
                    Chinese Session 
                    
                    <a class="label" href="/tracks/messaging.html">#messaging</a></li>
                </header>

                <p>Storage Engine for RocketMQ Based on Commitlog and RocksDB
Delay message, transaction message, POP and index are core features of RocketMQ. These features involve multiple state transitions in memory and are implemented based on the file system. The existing implementation faces the following issues:</p>
<ol>
<li>Queue-Based Implementation cause more merge operations (e.g., POP consumption result merging, transaction message OP message merging) that result in complex workflows, low efficiency, and poor scalability.</li>
<li>TimerWheel, TimerLog, Revive, and Index Files require additional storage.</li>
<li>Excessive intermediate states in memory cause performance issues, such as heavy GC pressure on heap memory from temporary objects like CK, ACK, and CKMock in POP consumption.</li>
<li>The multitude of disk files and intermediate states complicates tiered storage and elastic scaling. 
RocksDB is a high-performance embedded key-value storage engine developed by Facebook, widely used in databases, logging systems, and distributed storage. Unifying the storage engine with Commitlog and RocksDB，the key points is separating message data in two parts，Commitlog on the filesystem while migrating all index models in RocksDB. This approach offers significant advantages:</li>
<li>Using RocksDB&rsquo;s fast lookup capabilities to reduce coordination/synchronization in data processes to simplify complexity. For example, RocksDB&rsquo;s KV storage CRUD operations can replace the original two-queue merge process in POP consumption.</li>
<li>Restructures storage models to reduce the amount of stored data and improve storage efficiency. For instance, RocksDB&rsquo;s indexing capabilities can fully replace existing index features, don‘t need to save any Index Files anymore.</li>
<li>Uses RocksDB as a unified data migration interface to simplify the process of tiered storage and elastic scaling, it’s much earlier than current implementation.
This storage architecture significantly optimizes those core features. The refactoring not only simplifies the codebase and reduces maintenance costs, but also provides a robust and flexible solution for RocketMQ to handle growing business demands and complex storage environments.</li>
</ol>
<h3 id="speakers">Speakers:</h3>
<p><img src="https://sessionize.com/image/89b7-400o400o1-3UL89hviMkFYw2SmgNyGZM.jpg" width="200" /><br/></p>
<p>Zhou Li: aliyun</p>
<p>Messaging Expert at Alibaba Cloud, responsible for Alibaba&rsquo;s core messaging middleware</p>


                <div style="position:relative; padding-bottom:50%; width:90%; height:0">
                    <iframe src=""  class="iframe_video" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position:absolute; height: 100%; width: 100%;"></iframe>
                </div>

            </section>
        </div>
    </div>

    

<div id="footer">
  <section class="container">
    <header class="major">
      <h2>Connect with us</h2>
    </header>
    <div class="d-flex align-items-center justify-content-between mx-auto mb-5" style="max-width: 512px">
      <a href="https://www.facebook.com/ApacheSoftwareFoundation/">
        <img width="64" src="images/icon-facebook-128.png">
      </a>
      <a href="https://twitter.com/ApacheCon">
        <img width="64" src="images/icon-twitter-x-128.png">
      </a>
      <a href="http://s.apache.org/apachecon-slack">
        <img width="64" src="images/icon-slack-128.png">
      </a>
    </div>
		<p>Community Over Code operates under the terms of the <a href="https://www.apache.org/foundation/policies/conduct.html">Apache Software Foundation Code of Conduct</a>. </p>
    <p class="byline mb-0">Copyright 2025, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0. <br />Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</div>
    </section>
</div>
</div>


</body>
</html>
